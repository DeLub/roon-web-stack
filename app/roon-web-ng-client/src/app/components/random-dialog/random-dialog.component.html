<div class="random-dialog">
  <h2>
    <mat-icon fontIcon="shuffle" /> Random Album Filters
  </h2>
  <mat-dialog-content>
    <div class="sort-toggle">
      <button mat-stroked-button color="primary" (click)="setSortAlpha()" [disabled]="$sortMode() === 'alpha'">
        <mat-icon fontIcon="sort_by_alpha" /> A→Z
      </button>
      <button mat-stroked-button color="primary" (click)="setSortCount()" [disabled]="$sortMode() === 'count'">
        <mat-icon fontIcon="stacked_bar_chart" /> Most albums
      </button>
      <div class="counts-status">
        <ng-container *ngIf="$countsLoading(); else countsStatus">
          <mat-icon fontIcon="hourglass_empty" /> Loading counts…
        </ng-container>
        <ng-template #countsStatus>
          <ng-container *ngIf="$countsError(); else countsOk">
            <mat-icon fontIcon="error_outline" /> Counts unavailable
            <button mat-button (click)="retryCounts()">Retry</button>
          </ng-container>
          <ng-template #countsOk>
            <span class="faded" *ngIf="$counts().size > 0">Counts loaded</span>
          </ng-template>
        </ng-template>
      </div>
      <span class="spacer"></span>
    </div>
    <div class="legend" aria-hidden="true">
      <span class="chip included">Include</span>
      <span class="chip excluded">Exclude</span>
      <span class="chip disabled">0 albums</span>
    </div>
    <div class="presets">
      <button mat-stroked-button color="primary" (click)="savePresetPrompt()">
        <mat-icon fontIcon="save" /> Save preset
      </button>
      <div class="preset-list" *ngIf="$presets().length > 0">
        <span class="label">Presets:</span>
        @for (p of $presets(); let i = $index; track p.name) {
          <button mat-button class="preset" (click)="applyPreset(i)" [attr.aria-label]="'Apply preset ' + p.name">
            <mat-icon fontIcon="play_circle" /> {{ p.name }}
          </button>
          <button mat-icon-button class="preset-delete" (click)="deletePreset(i)" [attr.aria-label]="'Delete preset ' + p.name">
            <mat-icon fontIcon="delete" />
          </button>
        }
      </div>
    </div>
    <div class="genres" *ngIf="$genres().length > 0; else loading">
      <button
        class="genre"
        *ngFor="let g of $sortedGenres()"
        mat-button
        [class.included]="stateFor(g) === 'include'"
        [class.excluded]="stateFor(g) === 'exclude'"
        [disabled]="isDisabled(g)"
        [class.disabled]="isDisabled(g)"
        (click)="toggle(g)"
        [attr.aria-pressed]="stateFor(g) !== 'none'"
      >
        {{ g }}
        <ng-container *ngIf="countFor(g) as c"> ({{ c }}) </ng-container>
      </button>
    </div>
    <ng-template #loading>
      <div class="loading">
        <mat-icon fontIcon="hourglass_empty" /> Loading genres...
      </div>
    </ng-template>
  </mat-dialog-content>
  <mat-dialog-actions>
    <button mat-button (click)="clearAll()">Clear</button>
    <span class="spacer"></span>
    <button mat-raised-button color="primary" (click)="playNow()">Play Random Now</button>
  </mat-dialog-actions>
</div>
